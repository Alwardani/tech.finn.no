
<!doctype HTML>
<html>
<head>
<title>Tech Blog - Using the Constretto Configuration Factory</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" media="all" href="http://finncdn.no/bb/latest/css/so/so.css">
<!--[if IE 9 ]>
<link rel="stylesheet" type="text/css" media="screen,projection,handheld" href="http://finncdn.no/bb/latest/css/so/styles/so/ie9.css" />
<![endif]-->
<!--[if IE 8 ]>
<link rel="stylesheet" type="text/css" media="screen,projection,handheld" href="http://finncdn.no/bb/latest/css/so/styles/so/ie8.css" />
<![endif]-->
<!--[if lte IE 8]>
<link rel="stylesheet" type="text/css" media="screen,projection,handheld,print" href="http://finncdn.no/bb/latest/css/so/styles/so/ie.css" />
<![endif]-->
<link media="print" href="http://finncdn.no/bb/latest/css/so/styles/so/print.css">
<style>
body {
     height: 100%;
     margin: 0;
     padding: 0;
}
body > .media {
  margin-top: 0;
}
.xxl {
  padding-top: 70px;
}
.deco {
  background: url("http://cache.finn.no/img/decoration/decoration_frontpage.png") no-repeat center top;
  height: 57px;
  top: -24px;
  width: 840px;
  left: 94px;
  position: absolute;
}
.nerddeco {
  border-top: 2px solid black;
  background: url("http://hjemmehos.finn.no/no/webfolk_+_entusiaster/filestore/dev/GFX/menu_gadgets.png") no-repeat;
  height: 200px;
}
</style>
</head>
<body>

 <div class="media">
      <img class="img" src="http://finn-no.github.io/img/tech_logo.png">
      <p class=" bd h1 xxl"><a href="/">Tech Blog</a></p>
 </div>
 <div class="relative hidelt768">
  <div class="deco"></div>
 </div>
<div class="line pal" >
  <div class="unit r-size2of3">
    <div class="mod shadow">
      <div class="inner">
        <div class="bd">

          <h1>Using the Constretto Configuration Factory</h1>
<p class="meta">19 Jan 2011 by  in </p>

<div class="post">
<p>Development at FINN.no was quick to jump on the <a href="http://constretto.org">Constretto</a> library. It's a great addition to any application making it easy to handle different environments and profiles with just the one build.</p>

<p>When using Constretto at FINN.no one problem we found with the API is that it creates very verbose client code when the same ini or properties file is accessed throughout various class files.</p>

<p>For example a repetition of the following happens</p>

<pre><code>public static final String CONSTANT_A = new ConstrettoBuilder()
            .createIniFileConfigurationStore()
            .addResource(new DefaultResourceLoader().getResource("classpath:file.ini"))
            .done()
            .getConfiguration()
            .evaluateToString("CONSTANT_A");

public static final String CONSTANT_B = new ConstrettoBuilder()
            .createIniFileConfigurationStore()
            .addResource(new DefaultResourceLoader().getResource("classpath:file.ini"))
            .done()
            .getConfiguration()
            .evaluateToString("CONSTANT_B");
</code></pre>

<p>One way around this is to use spring injection. This makes nice concise code but comes with two flaws: the constants can no longer be constant (they have to be member fields), and you have to lump all your properties together into one big "globals" store (days of f77 comes to mind). A third problem with this approach is that you're passing Constretto's context through Spring's context, we don't really want chained contexts but direct access to individual contexts if possible.</p>

<p>So looking for a more elegant solution to all this we wrote a <a href="http://constretto.jira.com/secure/attachment/10010/constrettoconfigurationfactory.java">simple factory</a>, that has now been accepted upsteam,  that provides the necessary convenience methods so the constants can be declared short, sweet, and simple</p>

<pre><code>import static org.constretto.util.StaticlyCachedConfiguration.config;

public static final String CONSTANT_A = config("classpath:file.ini").evaluateToString("CONSTANT_A");
public static final String CONSTANT_B = config("classpath:file.ini").evaluateToString("CONSTANT_B");
</code></pre>

<p>This also caches the <code>ConstrettoConfiguration</code>s improving your application's startup performance.</p>

<p>This was taken from Constretto's <a href="http://constretto.jira.com/browse/CC-14">issue CC-14</a></p>

</div>



        </div>
      </div>
    </div>
  </div>
  <div class="unit r-size1of3">
    <div class="mod shadow mbn">
      <div class="inner">
        <div class="bd">

          <h2>Whatâ€™s this?</h2>
          <p>This is a blog run by the people creating the service <a href="http://www.finn.no">FINN.no</a>. Our purpose with this blog is to provide an insight into how we build things and to share our experiences with anyone who is interested in learning.
          </p>

          <h2>Categories</h2>
          <ul class="bullets phl">
            
              <li><a href="/categories/interface development.html">interface development</a></li>
            
              <li><a href="/categories/systems development.html">systems development</a></li>
            
              <li><a href="/categories/behind the scenes.html">behind the scenes</a></li>
            
              <li><a href="/categories/methodology.html">methodology</a></li>
            
          </ul>

          <h2>Blogroll</h2>
          <ul>
            <li><a href="http://labs.finn.no" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://labs.finn.no']);">FINN Labs</a></li>
            <li><a href="http://finn.no" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://finn.no']);">FINN.no</a></li>
            <li><a href="http://github.com/finn-no" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://github.com/finn-no']);">Our GitHub projects</a></li>
          </ul>
          <a class="phl" href="https://developer.mozilla.org/en/JavaScript" title="MDN JavaScript Home"><img src="http://static.jsconf.us/promotejsh.gif" height="150" width="180" alt="MDN JavaScript Home"></a>

        </div>
      </div>
    </div>
    <div class="mod nerddeco"></div>
  </div>
</div>
<div class="footer pal bg-contrast contrast">
  <a href="http://twitter.com/finn_tech">Finn Technology on Twitter</a> |
  <a href="http://tech.finn.no">Our developer blog</a> |
  <a href="http://hjemmehos.finn.no/no/jobbe_her+/">Come work with us!</a> |
  <a href="http://finn.no">FINN.no</a>
</div>
</div>
</body>
</html>